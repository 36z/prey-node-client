<?xml version="1.0"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

   <Product Id="*"
            UpgradeCode="14512BAA-B72E-45C8-93EB-8476B8DD0107"
            Name="Cron Service Stopper"
            Version="1.0"
            Manufacturer="Prey, Inc."
            Language="1033">
      <Package  InstallerVersion="200"
                Compressed="yes"
                InstallPrivileges="elevated"
                Comments="Windows Installer Package"/>
      <Media Id="1" Cabinet="product.cab" EmbedCab="yes"/>

      <Directory Id="TARGETDIR" Name="SourceDir">
        <Directory Id="WindowsFolder">
          <Directory Id="PreyDir" Name="Prey">
            <Component Id="PreyConfDefault"
                       Guid="F8AC062C-3FBC-432B-A322-FD2E354E3F30">
              <File Id="file_F8AC062C3FBC432BA322FD2E354E3F30"
                    Checksum="yes"
                    KeyPath="yes"
                    Source="source-msi\versions\$(var.ProductVersion)\prey.conf.default" />
            </Component>
          </Directory>
        </Directory>
      </Directory>

      <!-- Features to install -->
      <Feature Id="Complete"
               Title="Cron Service Stopper"
               Description="Does custom action to stop Cron Service"
               Level="1">
        <ComponentRef Id="PreyConfDefault" />
      </Feature>

      <!-- taskkill /f /im cronsvc.exe -->
      <SetProperty  Id="CommandServiceStop"
                    Before="AppSearch"
                    Value="&quot;taskkill&quot; /f /im cronsvc.exe"/>
      <CustomAction Id="CommandServiceStop"
                   BinaryKey="WixCA"
                   DllEntry="CAQuietExec"
                   Execute="deferred"
                   Impersonate="no"
                   Return="ignore"/>

      <!-- The action to be executed -->
      <InstallExecuteSequence>
         <Custom Action="CommandServiceStop"
                 After="PublishProduct">Installed</Custom>
      </InstallExecuteSequence>

   </Product>
</Wix>
